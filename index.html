<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iastro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/brain.js"></script>
    <script src="dataset.js"></script>
</head>
<body>
    <div class="container" id="resultado">
        <img src="./assets/rotating-galaxy.gif" height="300px">
    </div>
    <div class="controls">
        <label>Masa</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="mas-input" onchange="updateRed();"-->
		<input type="text" min="0.01" step="0.01" id="mas-input" value="0.815" onchange="updateRed();">
        <input type="text" id="mas-kpi" readonly><br>
        <label>Radio</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="rad-input" onchange="updateRed();"-->
		<input type="text" min="0.01" max="1" step="0.01" id="rad-input" value="0.95" onchange="updateRed();">
        <input type="text" id="rad-kpi" readonly><br>
        <label>Temperatura</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="tem-input" onchange="updateRed();"-->
		<input type="text" step="0.01" id="tem-input" value="464" onchange="updateRed();">
        <input type="text" id="tem-kpi" readonly><br>
        <input type="text" id="hab-result" class="habitable" readonly>
    </div>




    <script>
		const C_ITERATIONS = 50000;
		var red = new brain.NeuralNetwork();
        // var red = new brain.NeuralNetwork({
		// 	hiddenLayers: [3]
		// });
		//red.train(dataset_para_entrenar);
        red.train(dataset_para_entrenar, {
			errorThresh: 0.05,  		// error threshold to reach before completion
			iterations: C_ITERATIONS,   // maximum training iterations 
			log: true,           		// console.log() progress periodically 
			logPeriod: C_ITERATIONS/20,    // number of iterations between logging 
			learningRate: 0.25    		// learning rate 
		});

        var input1, input2, input3, kpi1, kpi2, kpi3, hab, res, crit;

        input1 = document.getElementById("mas-input");
        input2 = document.getElementById("rad-input");
        input3 = document.getElementById("tem-input");
        inputs = [input1, input2, input3]
        
        kpi1 = document.getElementById("mas-kpi");
        kpi2 = document.getElementById("rad-kpi");
        kpi3 = document.getElementById("tem-kpi");
        kpis = [kpi1, kpi2, kpi3];

		hab = document.getElementById("hab-result");
		res = document.getElementById("resultado");
		crit = 0.5; // MENORES A ESTE VALOR SON NO HABITABLES, MAYORES SON HABITABLES

        function updateRed() {
            for (let i = 0; i < inputs.length; i++) kpis[i].value = inputs[i].value;
            let input = {
                mas: inputs[0].value, 
                rad: inputs[1].value, 
                temp: inputs[2].value + 273.15
            };
            let output = red.run(input).hab;
			console.log("["+inputs[0].value + ", " + inputs[1].value + ", " + inputs[2].value + "] -> " + output);
            hab.value = "Habitabilidad: " + Math.round(output*100) + "%";
            if (output > crit) {
                res.innerHTML = `<img src="./assets/` + "habitable-planet" + `.jpg" height="300px" style="opacity: `+ output +`;">`;
                hab.classList.remove('no-habitable');
                hab.classList.add('habitable');
            } else {
                res.innerHTML = `<img src="./assets/` + "non-habitable-planet" + `.jpg" height="300px" style="opacity: `+ (1 - output) +`;">`;
                hab.classList.remove('habitable');
                hab.classList.add('no-habitable');
            }
            return output.hab;
        }

		function getHabitabilidad() {
			let q = dataset_test_habitables.length;
			dataset_test_habitables.forEach(elem => {elem.input.temp += 273.15});
			var minimo_h = 100;
			var maximo_h = 0;
			let cont_h = 0;
			let output, total = 0;
			let outputs = [];
			for (let i = 0; i < q; i++) {
				output = red.run(dataset_test_habitables[i].input).hab;
				total += output;
				outputs.push(output);
				(output >= crit) ? console.log("%c"+(output).toFixed(6), "color: green") : console.log("%c"+(output).toFixed(6), "color: red");
				if (output > crit) cont_h++;
				if (output < minimo_h) minimo_h = output;
				if (output > maximo_h) maximo_h = output;
			}
			let prom = total / q;
			console.log("De " + q + " planetas, el " + (cont_h / q * 100).toFixed(2) + "% es habitable según el criterio en " + crit);
			console.log("Mínimo = " + minimo_h.toFixed(5));
			console.log("Máximo = " + maximo_h.toFixed(5));
			console.log("Promedio = " + prom.toFixed(5));
			let outputs2 = outputs.map(element => {return (element - prom)**2});
			total = 0;
			outputs2.forEach(element => {total += element});
			console.log("Desviación estándar = " + Math.sqrt(total / (q - 1)).toFixed(5));
		}
    </script>
</body>
</html>