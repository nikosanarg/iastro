<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iastro</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/brain.js"></script>
    <script src="dataset.js"></script>
</head>
<body>
    <div class="container" id="resultado">
        <img src="./assets/rotating-galaxy.gif" height="300px">
    </div>
    <div class="controls">
        <label>Masa</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="mas-input" onchange="updateRed();"-->
		<input type="text" min="0.01" step="0.01" id="mas-input" onchange="updateRed();">
        <input type="text" id="mas-kpi" readonly><br>
        <label>Radio</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="rad-input" onchange="updateRed();"-->
		<input type="text" min="0.01" max="1" step="0.01" id="rad-input" onchange="updateRed();">
        <input type="text" id="rad-kpi" readonly><br>
        <label>Edad</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="eda-input" onchange="updateRed();"-->
		<input type="text" min="0.01" step="0.01" id="eda-input" onchange="updateRed();">
        <input type="text" id="eda-kpi" readonly><br>
        <label>Excentricidad</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="exc-input" onchange="updateRed();"-->
		<input type="text" min="0" step="0.01" id="exc-input" onchange="updateRed();">
        <input type="text" id="exc-kpi" readonly><br>
        <label>Temperatura</label><br>
        <!--input type="range" min="0.01" max="1" step="0.01" id="tem-input" onchange="updateRed();"-->
		<input type="text" step="0.01" id="tem-input" onchange="updateRed();">
        <input type="text" id="tem-kpi" readonly value="0.02"><br>
        <input type="text" id="hab-result" class="habitable" readonly>
    </div>




    <script>
		const C_NEURONAS = 5;
        const C_CAPAS = 1;
        var red = new brain.NeuralNetwork({
			hiddenLayers: [5, 7, 5]
		});
        red.train(dataset_para_entrenar, {
			errorThresh: 0.005,  // error threshold to reach before completion
			iterations: 2000,   // maximum training iterations 
			log: true,           // console.log() progress periodically 
			logPeriod: 10,       // number of iterations between logging 
			learningRate: 0.3    // learning rate 
		});

        var input1, input2, input3, input4, input5, 
            kpi1, kpi2, kpi3, kpi4, kpi5, 
            output, resultado, hab;
        input1 = document.getElementById("mas-input");
        input2 = document.getElementById("rad-input");
        input3 = document.getElementById("eda-input");
        input4 = document.getElementById("exc-input");
        input5 = document.getElementById("tem-input");
        inputs = [input1, input2, input3, input4, input5]
        hab = document.getElementById("hab-result");
        kpi1 = document.getElementById("mas-kpi");
        kpi2 = document.getElementById("rad-kpi");
        kpi3 = document.getElementById("eda-kpi");
        kpi4 = document.getElementById("exc-kpi");
        kpi5 = document.getElementById("tem-kpi");
        kpis = [kpi1, kpi2, kpi3, kpi4, kpi5];
        for (let i = 0; i < C_NEURONAS; i++) kpis[i].value = inputs[i].value = Math.random().toFixed(2);


        function updateRed() {
            let res = document.getElementById("resultado");
            for (let i = 0; i < C_NEURONAS; i++) kpis[i].value = inputs[i].value;
            let input = {
                mas: inputs[0].value, 
                rad: inputs[1].value, 
                eda: inputs[2].value, 
                exc: inputs[3].value, 
                temp: inputs[4].value
            };
            let output = red.run(input).hab.toFixed(2);
            hab.value = "Habitabilidad: " + Math.round(output*100) + "%";
            if (output > 0.5) {
                res.innerHTML = `<img src="./assets/` + "habitable-planet" + `.jpg" height="300px" style="opacity: `+ output +`;">`;
                hab.classList.remove('no-habitable');
                hab.classList.add('habitable');
            } else {
                res.innerHTML = `<img src="./assets/` + "non-habitable-planet" + `.jpg" height="300px" style="opacity: `+ (1 - output) +`;">`;
                hab.classList.remove('habitable');
                hab.classList.add('no-habitable');
            }
            return output.hab;
        }

		function getHabitabilidad() {
			let q = dataset_test_habitables.length;
			console.log(q);
			var minimo_h = 100;
			let cont_h = 0;
			let output;
			for (let i = 0; i < q; i++) {
				output = red.run(dataset_test_habitables[i].input).hab;
				console.log(output);
				if (output > 0.9) cont_h++;
				if (output < minimo_h) minimo_h = output;
			}
			console.log((cont_h / q * 100) + "%");
			console.log("minimo = " + minimo_h);
		}
    </script>
</body>
</html>